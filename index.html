<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cutter–Sanborn • Ficha catalográfica (módulo Cutter)</title>
  <meta name="description" content="Busca da notação de autor (Cutter–Sanborn) com normalização e pareamento por anterior imediato. Interface acessível e responsiva." />
  <link rel="stylesheet" href="assets/styles.css" />
</head>
<body>
  <a class="skip-link" href="#conteudo">Pular para o conteúdo</a>

  <header class="wrap app-header" role="banner">
    <div class="brand">
      <div class="logo" aria-hidden="true">C</div>
      <h1 class="title">Cutter–Sanborn • Módulo de Cutter</h1>
    </div>
  </header>

  <main id="conteudo" class="wrap" role="main">
    <section class="panel intro" aria-labelledby="intro-title">
      <h2 id="intro-title">Como usar</h2>
      <p>Informe o <strong>sobrenome do 1º autor</strong> <em>ou</em> o <strong>título sem artigo inicial</strong>. A busca aplica normalização (acentos/pontuação), trata <code>St./Ste.</code> → <em>Saint/Sainte</em>, <code>Mc/M’</code> → <em>Mac</em>, converte dígitos em palavras e trunca a 13 caracteres. O pareamento usa a regra do <strong>anterior imediato</strong> quando não houver entrada exata.</p>
      <p class="muted small">Observação: sufixos como <em>work mark</em> e regras de biografias/literatura podem ser ativados depois (a lógica fica no front-end sem precisar editar a tabela).</p>
    </section>

    <section class="panel search" aria-labelledby="busca-title">
      <h2 id="busca-title">Buscar Cutter</h2>

      <form id="formBusca" novalidate>
        <fieldset class="field-group" aria-describedby="modo-ajuda">
          <legend>Modo de entrada</legend>
          <div class="radios">
            <label class="radio"><input type="radio" name="modo" value="autor" checked> Autor (padrão)</label>
            <label class="radio"><input type="radio" name="modo" value="titulo"> Título (remove artigo inicial)</label>
          </div>
          <p id="modo-ajuda" class="muted small">No modo <em>Título</em>, artigos iniciais como “O, A, The, El, Le…” são ignorados na normalização.</p>
        </fieldset>

        <div class="grid-2">
          <div class="field">
            <label for="autor">Autor (Sobrenome, Prenome)</label>
            <input id="autor" name="autor" type="text" inputmode="latin-name" autocomplete="off" spellcheck="false" placeholder="Ex.: Escorel, João; Saint-Exupéry; O’Neill" aria-describedby="autor-ajuda" />
            <div id="autor-ajuda" class="muted small">Se houver vírgula, usaremos o trecho antes da vírgula como sobrenome.</div>
          </div>

          <div class="field">
            <label for="titulo">Título (sem artigo inicial)</label>
            <input id="titulo" name="titulo" type="text" autocomplete="off" spellcheck="false" placeholder="Ex.: Vivências; História da Ciência" />
          </div>
        </div>

        <div class="grid-3">
          <div class="field">
            <label for="entrada">Entrada usada</label>
            <output id="entrada" class="readonly-box" aria-live="polite" aria-atomic="true">—</output>
          </div>
          <div class="field">
            <label for="normalizada">Chave normalizada</label>
            <output id="normalizada" class="readonly-box" aria-live="polite" aria-atomic="true">—</output>
          </div>
          <div class="field">
            <label for="explicacao">Regra aplicada</label>
            <output id="explicacao" class="readonly-box" aria-live="polite" aria-atomic="true">—</output>
          </div>
        </div>

        <div class="actions">
          <button id="btnBuscar" class="btn primary" type="button">Buscar</button>
          <button id="btnLimpar" class="btn" type="reset">Limpar</button>
        </div>
      </form>

      <div class="answer" role="region" aria-live="polite" aria-label="Resultado">
        <div class="ansrow">
          <div class="result-code" aria-describedby="code-help">
            <div id="codigo" class="bigcode" data-empty>—</div>
            <div id="code-help" class="muted small">Código Cutter (letra + 3 dígitos)</div>
          </div>
          <div class="result-key">
            <div class="label">Entrada da tabela</div>
            <div id="chave" class="keytext">—</div>
          </div>
          <div class="copy">
            <button id="btnCopiar" class="btn" type="button" disabled>Copiar</button>
          </div>
        </div>
        <div id="vizinhos" class="neighbors" aria-label="Próximos na tabela"></div>
      </div>
    </section>

    <section class="panel help" aria-labelledby="acessibilidade-title">
      <h2 id="acessibilidade-title">Acessibilidade</h2>
      <ul class="muted">
        <li>Foco visível em todos os controles.</li>
        <li>Leitura anunciada de resultados (<code>aria-live</code>).</li>
        <li>Alto contraste e tamanhos de clique confortáveis.</li>
        <li>Layout sem colunas obrigatórias para leitura linear; em telas menores, os blocos se empilham.</li>
      </ul>
    </section>
  </main>

  <footer class="wrap footer small" role="contentinfo">
    <p>Interface por <strong>Bernardo Vechi</strong>. Lógica baseada em Cutter / Cutter–Sanborn. Dados em <code>data/cutter-sanborn.json</code>.</p>
  </footer>

  <noscript>
    <div class="wrap noscript">Este aplicativo precisa de JavaScript para realizar a busca na tabela Cutter–Sanborn.</div>
  </noscript>

  <!-- Aplicação: módulos separados -->
  <script type="module">
    import * as Normalizer from './src/normalizer.js';
    import * as Matcher from './src/matcher.js';
    import { setupUI } from './src/ui.js';

    // Carrega dataset e inicializa UI
    try {
      const res = await fetch('./data/cutter-sanborn.json', { cache: 'no-store' });
      if (!res.ok) throw new Error('Falha ao carregar data/cutter-sanborn.json');
      const table = await res.json(); // [{key, code}, ...]
      const index = Matcher.buildIndex(table, Normalizer);
      setupUI({ index, Normalizer, Matcher });
    } catch (err) {
      console.error(err);
      const codigo = document.getElementById('codigo');
      const chave  = document.getElementById('chave');
      const explic = document.getElementById('explicacao');
      if (codigo) codigo.textContent = '—';
      if (chave) chave.textContent = 'Erro ao carregar dataset';
      if (explic) explic.textContent = 'Verifique se o arquivo JSON está em data/cutter-sanborn.json';
    }
  </script>
</body>
</html>
